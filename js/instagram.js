var Instagram=function(){var a=[],m=function(t){for(var i in t){for(var a="",e=0,n=t[i].srclist.length;e<n;e++)a+='<li>\t\t\t\t\t\t\t\t<div class="img-box">\t\t\t\t\t\t\t\t\t<a class="img-bg" rel="example_group" href="'+t[i].bigSrclist[e]+'" title="'+t[i].text[e]+'"></a>\t\t\t\t\t\t\t\t\t<img lazy-src="'+t[i].srclist[e]+'" alt="">\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</li>';$('<section class="archives album"><h1 class="year">'+t[i].year+"<em>"+t[i].month+'月</em></h1>\t\t\t\t<ul class="img-box-ul">'+a+"</ul>\t\t\t\t</section>").appendTo($(".instagram"))}$(".instagram").lazyload(),r(),setTimeout(function(){!function(t){for(var i in t)for(var a=0,e=t[i].srclist.length;a<e;a++){var n=t[i].bigSrclist[a];(new Image).src=n}}(t)},3e3),$("a[rel=example_group]").fancybox()},g=function(t){if(0<=t.indexOf("outbound-distilleryimage"))return"http://distilleryimage"+t.match(/outbound-distilleryimage([\s\S]*?)\//)[1]+".ak.instagram.com/"+(i=t.split("/"))[i.length-1];var i;return"http://photos-g.ak.instagram.com/hphotos-ak-xpf1/"+(i=t.split("/"))[i.length-1]},e=function(t){$(".open-ins").html("图片来自instagram，正在加载中…"),$.ajax({url:t,type:"GET",dataType:"jsonp",success:function(t){if(200==t.meta.code){a=a.concat(t.data);var i=t.pagination.next_url;i?e(i):($(".open-ins").html("图片来自instagram，点此访问"),function(t){for(var i={},a=0,e=t.length;a<e;a++){var n=new Date(1e3*t[a].created_time),r=n.getFullYear(),s=n.getMonth()+1,o=g(t[a].images.low_resolution.url),l=g(t[a].images.standard_resolution.url),c=t[a].caption?t[a].caption.text:"",u=r+"-"+s;i[u]?(i[u].srclist.push(o),i[u].bigSrclist.push(l),i[u].text.push(c)):i[u]={year:r,month:s,srclist:[l],bigSrclist:[l],text:[c]}}m(i)}(a))}else alert("access_token timeout!")}})},r=function(){if($(document).width()<=600)$(".img-box").css({width:"auto",height:"auto"});else{var t=$(".img-box-ul").width(),i=Math.max(.26*t,157);$(".img-box").width(i).height(i)}};return{init:function(){var t=$(".instagram").attr("data-client-id"),i=$(".instagram").attr("data-user-id");if(!t)return alert("Didn't set your instagram client_id.\nPlease see the info on the console of your brower."),void console.log("Please open 'http://instagram.com/developer/clients/manage/' to get your client-id.");e("https://api.instagram.com/v1/users/"+i+"/media/recent/?client_id="+t+"&count=100"),$(window).resize(function(){r()})}}}();$(function(){Instagram.init()});